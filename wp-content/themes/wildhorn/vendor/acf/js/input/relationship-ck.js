/*
*  Relationship
*
*  @description: 
*  @since: 3.5.8
*  @created: 17/01/13
*/(function(e){var t=acf.fields.relationship;e(document).live("acf/setup_fields",function(n,r){e(r).find(".acf_relationship").each(function(){if(acf.helpers.is_clone_field(e(this).children('input[type="hidden"]')))return;e(this).find(".relationship_right .relationship_list").height(e(this).find(".relationship_left").height()-2);e(this).find(".relationship_right .relationship_list").sortable({axis:"y",items:"> li",forceHelperSize:!0,forcePlaceholderSize:!0,scroll:!0});e(this).find(".relationship_left .relationship_list").scrollTop(0).scroll(function(){var n=e(this).closest(".acf_relationship");if(n.hasClass("loading"))return;if(e(this).scrollTop()+e(this).innerHeight()>=e(this).get(0).scrollHeight){var r=parseInt(n.attr("data-paged"));n.attr("data-paged",r+1);t.update_results(n)}});t.update_results(e(this))})});e(".acf_relationship .relationship_left .relationship_list a").live("click",function(){var n=e(this).attr("data-post_id"),r=e(this).html(),i=e(this).closest(".acf_relationship"),s=parseInt(i.attr("data-max")),o=i.find(".relationship_right .relationship_list");if(o.find("a").length>=s){alert(t.text.max.replace("{max}",s));return!1}if(e(this).parent().hasClass("hide"))return!1;e(this).parent().addClass("hide");var u=i.children(".tmpl-li").html().replace(/\{post_id}/gi,n).replace(/\{title}/gi,r);$el=e(u);o.append($el);$el.find("input").trigger("change");i.closest(".field").removeClass("error");e(this).blur();return!1});e(".acf_relationship .relationship_right .relationship_list a").live("click",function(){var t=e(this).attr("data-post_id"),n=e(this).closest(".acf_relationship"),r=n.find(".relationship_left .relationship_list");e(this).parent().remove();r.find('a[data-post_id="'+t+'"]').parent("li").removeClass("hide");e(this).blur();return!1});e(".acf_relationship input.relationship_search").live("keypress",function(e){if(e.which==13)return!1}).live("keyup",function(){var n=e(this).val(),r=e(this).closest(".acf_relationship");r.attr("data-s",n);r.attr("data-paged",1);clearTimeout(t.timeout);t.timeout=setTimeout(function(){t.update_results(r)},250);return!1}).live("focus",function(){e(this).siblings("label").hide()}).live("blur",function(){e(this).val()==""&&e(this).siblings("label").show()});e(".acf_relationship .select-post_type").live("change",function(){var n=e(this).val(),r=e(this).closest(".acf_relationship");r.attr("data-post_type",n);t.update_results(r)});t.hide_results=function(t){var n=t.find(".relationship_left .relationship_list"),r=t.find(".relationship_right .relationship_list");n.find("a").each(function(){var t=e(this).attr("data-post_id");r.find('a[data-post_id="'+t+'"]').exists()&&e(this).parent().addClass("hide")})};t.update_results=function(n){n.addClass("loading");var r={},i=n.find(".relationship_left .relationship_list"),s=n.find(".relationship_right .relationship_list");e.each(n[0].attributes,function(e,t){if(t.name.substr(0,5)!="data-")return;if(t.name=="data-max")return;r[t.name.replace("data-","")]=t.value});e.ajax({url:ajaxurl,type:"post",dataType:"html",data:e.extend(r,{action:"acf/fields/relationship/query_posts",post_id:acf.post_id,nonce:acf.nonce}),success:function(s){n.removeClass("no-results").removeClass("loading");r.paged==1&&i.find("li:not(.load-more)").remove();if(!s){n.addClass("no-results");return}i.find(".load-more").before(s);var o=e("<ul>"+s+"</ul>");o.find("li").length<10&&n.addClass("no-results");t.hide_results(n)}})}})(jQuery);